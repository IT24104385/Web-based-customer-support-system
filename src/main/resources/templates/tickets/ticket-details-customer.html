<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Ticket Details</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div class="container">
    <div class="nav">
        <a th:href="@{/customer/tickets}">Back to My Tickets</a>
        <form th:action="@{/logout}" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit">Logout</button>
        </form>
    </div>

    <h2 th:text="'Ticket #' + ${ticket.id} + ': ' + ${ticket.subject}"></h2>
    <p>Status: <span th:text="${ticket.status}"></span></p>
    <p>Description: <span th:text="${ticket.description}"></span></p>

    <h3>Conversation</h3>
    <div th:each="m : ${messages}">
        <p><b th:text="${m.author.fullName}"></b>: <span th:text="${m.content}"></span></p>
    </div>

    <p th:if="${error}" class="error" th:text="${error}"></p>
    <h3>Feedback</h3>
    <div th:if="${feedback != null}">
        <p><b>Rating:</b> <span th:text="${feedback.rating}"></span>/5</p>
        <p><b>Comment:</b> <span th:text="${feedback.comment}"></span></p>
    </div>

    <div th:if="${feedback == null}">
        <p th:if="${ticket.status.name() == 'CLOSED'}">
            <a th:href="@{'/customer/feedback/' + ${ticket.id}}">Submit Feedback</a>
        </p>
        <p th:if="${ticket.status.name() != 'CLOSED'}">
            Feedback can be submitted once the ticket is closed.
        </p>
    </div>



    <h3>Add Reply</h3>
    <form th:action="@{'/customer/tickets/' + ${ticket.id} + '/reply'}" method="post" th:object="${newMessage}">
        <textarea th:field="*{content}" rows="3"></textarea><br>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button type="submit">Send</button>
    </form>
</div>
</body>
</html>
